{# Bootstrap 3 Form Template #}
{% if stepper_enabled %}
    {% include template_from_string(include('bootstrap3/form_stepper.twig')) %}
{% else %}
<form {{ form.attributes|attributes|raw }}>
    {% if csrf_token %}
        <input type="hidden" name="_csrf_token" value="{{ csrf_token }}" />
    {% endif %}

    {% for input in inputs %}
        {% if input.is_section %}
            {# Render section with its inputs #}
            {% if input.section %}
                <div class="form-section {{ input.section.classes|join(' ') }}" {% for attr, value in input.section.attributes %}{{ attr }}="{{ value }}" {% endfor %}>
                    {% if input.section.collapsible %}
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" href="#section-{{ loop.index }}">
                                        {{ input.section.title }}
                                    </a>
                                </h4>
                            </div>
                            <div id="section-{{ loop.index }}" class="panel-collapse collapse {{ not input.section.collapsed ? 'in' : '' }}">
                                <div class="panel-body">
                                    {% if input.section.description %}
                                        <p class="text-muted">{{ input.section.description|raw }}</p>
                                    {% endif %}
                                    {% if input.section.htmlContent %}
                                        <div class="section-content">{{ input.section.htmlContent|raw }}</div>
                                    {% endif %}
                                    {% for section_input in input.inputs %}
                                        {% include template_from_string(include(section_input.template)) %}
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% else %}
                        <h3 class="form-section-title">{{ input.section.title }}</h3>
                        {% if input.section.description %}
                            <p class="text-muted">{{ input.section.description|raw }}</p>
                        {% endif %}
                        {% if input.section.htmlContent %}
                            <div class="section-content">{{ input.section.htmlContent|raw }}</div>
                        {% endif %}
                        {% for section_input in input.inputs %}
                            {% include template_from_string(include(section_input.template)) %}
                        {% endfor %}
                    {% endif %}
                </div>
            {% else %}
                {# Section is null - render inputs without section wrapper #}
                {% for section_input in input.inputs %}
                    {% include template_from_string(include(section_input.template)) %}
                {% endfor %}
            {% endif %}
        {% else %}
            {# Regular input (no sections used) #}
            {% include template_from_string(include(input.template)) %}
        {% endif %}
    {% endfor %}
</form>
{% endif %}
