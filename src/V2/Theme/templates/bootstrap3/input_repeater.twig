{# Bootstrap 3 Repeater Template #}
<div class="{{ classes.wrapper }}{% if error %} has-error{% endif %}" {{ wrapperAttributes|attributes|raw }}>
    {% if label %}
        <label class="{{ classes.label }}">
            {{ label }}
            {% if required %}<span class="text-danger">*</span>{% endif %}
        </label>
    {% endif %}

    {% if helpText %}
        <span class="{{ classes.help }}">{{ helpText }}</span>
    {% endif %}

    <div data-repeater="{{ attributes.id }}">
        {# Template row (hidden) #}
        <div class="{{ classes['item'] }}" data-repeater-template style="display: none;">
            <div class="{{ classes['item-header'] }}">
                <strong data-repeater-row-number></strong>
                <button type="button" class="{{ classes['remove-button'] }} pull-right" data-repeater-remove>
                    Remove
                </button>
            </div>
            <div class="{{ classes['item-body'] }}">
                {% if repeaterFields %}
                    {% for field in repeaterFields.inputs %}
                        {% if field.is_section %}
                            {% for section_input in field.inputs %}
                                {% include template_from_string(include(section_input.template)) with section_input %}
                            {% endfor %}
                        {% else %}
                            {% include template_from_string(include(field.template)) with field %}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
        </div>

        {# Initial rows (if any default data) #}
        {% if value is iterable and value is not empty %}
            {% for index, rowData in value %}
                <div class="{{ classes['item'] }}" data-repeater-item>
                    <div class="{{ classes['item-header'] }}">
                        <strong data-repeater-row-number>#{{ index + 1 }}</strong>
                        <button type="button" class="{{ classes['remove-button'] }} pull-right" data-repeater-remove>
                            Remove
                        </button>
                    </div>
                    <div class="{{ classes['item-body'] }}">
                        {% if repeaterFields %}
                            {% for field in repeaterFields.inputs %}
                                {% set fieldWithValue = field|merge({'value': rowData[field.name]|default('')}) %}
                                {% if field.is_section %}
                                    {% for section_input in field.inputs %}
                                        {% set sectionFieldWithValue = section_input|merge({'value': rowData[section_input.name]|default('')}) %}
                                        {% include template_from_string(include(section_input.template)) with sectionFieldWithValue %}
                                    {% endfor %}
                                {% else %}
                                    {% include template_from_string(include(field.template)) with fieldWithValue %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        {# Add button container #}
        <div style="margin-top: 15px;" data-repeater-add-container>
            <button type="button" class="{{ classes['add-button'] }}" data-repeater-add>
                Add Item
            </button>
        </div>
    </div>

    {% if error %}
        <span class="{{ classes.error }}">{{ error }}</span>
    {% endif %}
</div>
